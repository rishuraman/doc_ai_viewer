{% extends "base.html" %}

{% block content %}
<div class="grid-2col">
    <!-- Upload Panel -->
    <section class="card card-upload">
        <div class="card-header">
            <h2>Upload Document</h2>
            <span class="pill pill-soft">PDF · JPG · PNG</span>
        </div>

        <form method="POST" enctype="multipart/form-data" class="upload-form">
            {% if error %}
                <div class="alert alert-error">
                    {{ error }}
                </div>
            {% endif %}

            <label class="file-drop">
                <input type="file" name="document" accept=".pdf,.jpg,.jpeg,.png">
                <div class="file-drop-inner">
                    <div class="file-icon"></div>
                    <p class="file-title">Drag & drop your file here</p>
                    <p class="file-subtitle">or click to browse from your computer</p>
                    <p class="file-hint">Max 10MB · Supported: Driving License, Flood Certificate, W2, Paystub, Passport</p>
                </div>
            </label>

            <button type="submit" class="btn btn-primary btn-full">
                Analyze Document
            </button>
        </form>

        <div class="helper-text">
            <span class="dot pulse"></span>
            <span>We only store extracted text & key fields in a local SQLite DB for the demo.</span>
        </div>
    </section>

    <!-- Results Panel -->
    <section class="card card-results">
        <div class="card-header">
            <h2>Analysis Result</h2>
            {% if doc_type %}
                <span class="pill pill-strong">{{ doc_type }}</span>
            {% else %}
                <span class="pill pill-muted">No document analyzed yet</span>
            {% endif %}
        </div>

        {% if doc_type %}
            <div class="result-section">
                <h3 class="section-title">Detected Document Type</h3>
                <p class="doc-type-chip">{{ doc_type }}</p>
            </div>

            <div class="result-section">
                <h3 class="section-title">Extracted Fields</h3>
                {% if fields %}
                    <div class="table-wrapper">
                        <table class="field-table">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for key, value in fields.items() %}
                                    {% if value %}
                                    <tr>
                                        <td>{{ key.replace("_", " ") | title }}</td>
                                        <td>{{ value }}</td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="empty-state">
                        No fields extracted. This may be an unsupported layout or an image-only scan with low OCR quality.
                    </p>
                {% endif %}
            </div>

            <div class="result-section">
                <div class="collapsible">
                    <input type="checkbox" id="toggle-raw-text">
                    <label for="toggle-raw-text" class="collapsible-header">
                        <span>Show raw text</span>
                        <span class="chevron"></span>
                    </label>
                    <div class="collapsible-body">
                        <pre class="raw-text">{{ text }}</pre>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="empty-state big">
                <p>No document processed yet.</p>
                <p>Upload a PDF or image on the left to see classification and extracted fields here.</p>
            </div>
        {% endif %}
    </section>
</div>
{% endblock %}
